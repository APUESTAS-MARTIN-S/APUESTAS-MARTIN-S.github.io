<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Apuestas Martin's ‚Äì Boletas Chontico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #022c22;
      --card: #021813;
      --accent: #22c55e;
      --accent-strong: #16a34a;
      --ok: #22c55e;
      --danger: #ef4444;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(34,197,94,0.45);
      --shadow-soft: 0 18px 35px rgba(4, 23, 16, 0.85);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #047857 0, #022c22 45%, #01100c 100%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    main {
      width: 100%;
      max-width: 1080px;
      background: linear-gradient(145deg, rgba(6,78,59,0.98), rgba(3,47,36,0.99));
      border-radius: 26px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 20px 18px 18px;
      position: relative;
      overflow: hidden;
    }

    main::before,
    main::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      filter: blur(45px);
      opacity: 0.35;
      pointer-events: none;
    }

    main::before {
      width: 260px;
      height: 260px;
      background: radial-gradient(circle, rgba(34,197,94,0.7), transparent 60%);
      top: -90px;
      right: -70px;
    }

    main::after {
      width: 240px;
      height: 240px;
      background: radial-gradient(circle, rgba(21,128,61,0.7), transparent 60%);
      bottom: -80px;
      left: -40px;
    }

    .content {
      position: relative;
      z-index: 1;
    }

    /* BANNER CON LOGO */
    .banner {
      border-radius: 22px;
      overflow: hidden;
      border: 1px solid rgba(22,163,74,0.7);
      box-shadow: 0 14px 32px rgba(4,20,14,0.95);
      margin-bottom: 18px;
      background: #064e3b;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px 10px;
    }

    .banner-img {
      width: 100%;
      max-height: 260px;
      object-fit: contain;
      display: block;
    }

    /* MARCA */
    .header-brand {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 18px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #15803d);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-weight: 700;
      font-size: 18px;
      color: white;
      box-shadow: 0 0 0 1px rgba(3,24,17,0.9);
    }

    .logo-text-main {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: 18px;
      letter-spacing: 0.03em;
    }

    .logo-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .tag-age {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(1,17,13,0.96);
      border: 1px solid rgba(22,163,74,0.7);
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .tag-age span.badge {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(248,250,252,0.06);
      color: #e5e7eb;
      font-size: 11px;
      font-weight: 600;
    }

    @media (max-width: 640px) {
      .header-brand {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* HERO VALORES */
    .hero {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.1fr);
      gap: 20px;
      margin-bottom: 18px;
    }

    @media (max-width: 820px) {
      .hero {
        grid-template-columns: 1fr;
      }
    }

    .hero-left {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(3,24,17,0.9);
      border: 1px solid rgba(34,197,94,0.7);
      font-size: 11px;
      color: var(--text-muted);
      width: fit-content;
    }

    .eyebrow span {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #e5e7eb;
    }

    .title {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: clamp(24px, 3.6vw, 30px);
      line-height: 1.2;
      letter-spacing: 0.01em;
    }

    .title strong {
      color: var(--accent);
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-muted);
      max-width: 520px;
    }

    .hero-right {
      background: rgba(1,17,13,0.96);
      border-radius: 18px;
      border: 1px solid rgba(22,163,74,0.7);
      padding: 12px 12px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hero-right-title {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(1,17,13,1);
      border: 1px solid rgba(22,163,74,0.6);
      font-size: 11px;
      color: #e5e7eb;
    }

    .pill strong {
      color: var(--accent);
      font-weight: 600;
    }

    /* BUSCADOR DE BOLETA */
    .finder-section {
      background: rgba(1,17,13,0.98);
      border-radius: 18px;
      border: 1px solid rgba(22,163,74,0.7);
      padding: 12px 12px 14px;
      margin-bottom: 18px;
    }

    .finder-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 10px;
    }

    .finder-title {
      font-size: 15px;
      font-weight: 600;
    }

    .finder-note {
      font-size: 12px;
      color: var(--text-muted);
    }

    @media (max-width: 640px) {
      .finder-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .finder-controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 10px;
    }

    .finder-label {
      font-size: 13px;
    }

    .finder-select {
      min-width: 140px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      background: #02130f;
      color: var(--text-main);
      font-size: 14px;
    }

    .finder-select:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px var(--accent-strong);
    }

    .finder-result {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr);
      gap: 12px;
      align-items: flex-start;
    }

    @media (max-width: 720px) {
      .finder-result {
        grid-template-columns: 1fr;
      }
    }

    .finder-card {
      background: #020f0b;
      border-radius: 14px;
      border: 1px solid rgba(12,83,52,0.96);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .finder-number-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .finder-number {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: 26px;
    }

    .finder-status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid transparent;
    }

    .finder-status-pill.ok {
      background: rgba(22,163,74,0.18);
      border-color: rgba(34,197,94,0.8);
      color: #bbf7d0;
    }

    .finder-status-pill.out {
      background: rgba(248,113,113,0.16);
      border-color: rgba(248,113,113,0.9);
      color: #fee2e2;
    }

    .finder-status-pill.neutral {
      background: rgba(1,17,13,0.9);
      border-color: rgba(148,163,184,0.6);
      color: var(--text-muted);
    }

    .finder-info {
      font-size: 12px;
      color: var(--text-muted);
    }

    .finder-number-picker {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .finder-number-picker-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .finder-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }

    /* DINO DENTRO DEL BLOQUE DERECHO, ENCIMA DE BOTONES */
    .dino-inline-img {
      max-width: 230px;
      width: 100%;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(34,197,94,0.7);
      box-shadow: 0 10px 22px rgba(2,23,16,0.9);
      background: #022c22;
    }

    .dino-inline-img img {
      width: 100%;
      display: block;
      object-fit: cover;
    }

    /* BOTONES */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 9px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, background 0.1s ease-out, border-color 0.1s ease-out, opacity 0.1s ease-out;
      white-space: nowrap;
      width: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      box-shadow: 0 12px 25px rgba(22,163,74,0.6);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(22,163,74,0.8);
    }

    .btn-primary.disabled {
      opacity: 0.5;
      box-shadow: none;
      cursor: default;
      transform: none;
    }

    .btn-secondary {
      background: rgba(1,17,13,0.95);
      border-color: rgba(148,163,184,0.5);
      color: var(--text-main);
      font-size: 12px;
      padding: 7px 12px;
    }

    .btn-secondary:hover {
      background: rgba(1,20,15,0.98);
      border-color: #e5e7eb;
    }

    /* TABLA COMPLETA */
    .tickets-table-wrapper {
      margin-top: 8px;
      max-height: 280px;
      overflow: auto;
      border-radius: 12px;
      border: 1px solid rgba(7,43,29,0.95);
      background: #020f0b;
      display: none;
    }

    .tickets-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .tickets-table thead {
      position: sticky;
      top: 0;
      background: #022c22;
      z-index: 1;
    }

    .tickets-table th,
    .tickets-table td {
      padding: 6px 10px;
      text-align: left;
    }

    .tickets-table th {
      font-weight: 600;
      background: #022c22;
      color: #e5e7eb;
    }

    .tickets-table tbody tr:nth-child(even) {
      background: #020f0b;
    }

    .tickets-table tbody tr:nth-child(odd) {
      background: #031611;
    }

    .badge-status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
    }

    .badge-status.ok {
      background: rgba(22,163,74,0.18);
      color: #bbf7d0;
    }

    .badge-status.out {
      background: rgba(248,113,113,0.16);
      color: #fee2e2;
    }

    /* PAGOS */
    .payments {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 14px;
      margin-bottom: 10px;
    }

    @media (max-width: 780px) {
      .payments {
        grid-template-columns: 1fr;
      }
    }

    .payments-card {
      background: rgba(1,17,13,0.98);
      border-radius: 16px;
      border: 1px solid rgba(22,163,74,0.7);
      padding: 10px 12px 9px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
    }

    .payments-title {
      font-size: 14px;
      font-weight: 600;
    }

    .payments-list-vertical {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .payments-list-vertical li {
      padding: 6px 8px;
      border-radius: 10px;
      background: var(--card);
      border: 1px solid rgba(22,163,74,0.7);
      line-height: 1.4;
    }

    .payments-list-vertical strong {
      display: block;
      margin-bottom: 2px;
    }

    .payments-note-small {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* FOOTER */
    .footer {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }

    /* ADMIN */
    #admin-trigger {
      position: fixed;
      bottom: 4px;
      right: 4px;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      opacity: 0;
      cursor: pointer;
      z-index: 50;
    }

    #admin-panel {
      position: fixed;
      bottom: 14px;
      right: 14px;
      width: 260px;
      max-width: calc(100% - 28px);
      background: #020f0b;
      border-radius: 14px;
      border: 1px solid rgba(22,163,74,0.7);
      box-shadow: 0 16px 32px rgba(1,15,11,0.95);
      padding: 10px 12px;
      font-size: 12px;
      color: var(--text-main);
      z-index: 60;
      display: none;
    }

    #admin-panel-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    #admin-panel-note {
      color: var(--text-muted);
      font-size: 11px;
      margin-bottom: 6px;
    }

    #admin-category,
    #admin-select {
      width: 100%;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      background: #02130f;
      color: var(--text-main);
      font-size: 13px;
      margin-bottom: 6px;
    }

    #admin-category:focus,
    #admin-select:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px var(--accent-strong);
    }

    #admin-status {
      margin-bottom: 6px;
    }

    #admin-close {
      position: absolute;
      top: 4px;
      right: 8px;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
    }

    #admin-close:hover {
      color: #e5e7eb;
    }
  </style>
</head>
<body>
  <main>
    <div class="content">
      <!-- BANNER CON LOGO (logo.jpeg en la misma carpeta) -->
      <section class="banner">
        <img src="logo.jpeg" alt="Apuestas Martin's" class="banner-img">
      </section>

      <!-- MARCA -->
      <header class="header-brand">
        <div class="logo">
          <div class="logo-mark">M</div>
          <div>
            <div class="logo-text-main">Apuestas Martin's</div>
            <div class="logo-text-sub">Boletas Chontico</div>
          </div>
        </div>
        <div class="tag-age">
          <span class="badge">+18</span>
          <span>Solo mayores de edad</span>
        </div>
      </header>

      <!-- VALORES -->
      <section class="hero">
        <div class="hero-left">
          <div class="eyebrow">
            <span>Boletas Chontico</span>
          </div>
          <h2 class="title">
            Valores en <strong>CLP</strong> y <strong>COP</strong>.
          </h2>
          <p class="subtitle">
            Elige la categor√≠a de Chontico, selecciona el n√∫mero y revisa disponibilidad.
          </p>
        </div>

        <aside class="hero-right">
          <div class="hero-right-title">Valores por tipo de boleta</div>
          <div class="pill-row">
            <div class="pill">
              <strong>CHONTICO DOMINGO D√çA</strong><br>
              <span>$1.000 CLP ¬∑ $4.000 COP</span>
            </div>
            <div class="pill">
              <strong>CHONTICO S√ÅBADO Y DOMINGO NOCHE</strong><br>
              <span>$3.000 CLP ¬∑ $12.000 COP</span>
            </div>
            <div class="pill">
              <strong>CHONTICO DE LUNES A VIERNES NOCHE</strong><br>
              <span>$2.000 CLP ¬∑ $8.000 COP</span>
            </div>
            <div class="pill">
              <strong>CHONTICO DE LUNES A S√ÅBADO D√çA</strong><br>
              <span>$2.000 CLP ¬∑ $8.000 COP</span>
            </div>
          </div>
        </aside>
      </section>

      <!-- BUSCADOR -->
      <section class="finder-section">
        <div class="finder-header">
          <h3 class="finder-title">N√∫mero de boleta</h3>
          <p class="finder-note">
            Categor√≠as de Chontico ¬∑ N√∫meros del 00 al 99.
          </p>
        </div>

        <div class="finder-controls-row">
          <span class="finder-label">Categor√≠a:</span>
          <select id="category-select" class="finder-select"></select>
        </div>

        <div class="finder-result">
          <div class="finder-card">
            <div class="finder-number-label">Categor√≠a</div>
            <div id="finder-category-label" class="finder-info">‚Äî</div>

            <div class="finder-number-label">N√∫mero seleccionado</div>
            <div id="finder-number" class="finder-number">--</div>

            <div id="finder-status-pill" class="finder-status-pill neutral">
              Selecciona un n√∫mero para ver su disponibilidad
            </div>
            <div id="finder-info" class="finder-info">
              Estado actual del n√∫mero.
            </div>

            <div class="finder-number-picker">
              <span class="finder-number-picker-label">Elegir n√∫mero:</span>
              <select id="ticket-select" class="finder-select" aria-label="N√∫mero de boleta"></select>
            </div>
          </div>

          <div class="finder-actions">
            <div class="dino-inline-img">
              <img src="dino.jpg" alt="Dino Martin's">
            </div>
            <a id="reserve-button" href="#" target="_blank" class="btn btn-primary disabled" aria-disabled="true">
              Reservar por WhatsApp
            </a>
            <button id="toggle-table" type="button" class="btn btn-secondary">
              Ver lista completa de n√∫meros
            </button>
          </div>
        </div>

        <!-- TABLA COMPLETA -->
        <div class="tickets-table-wrapper" id="tickets-table-wrapper" aria-hidden="true">
          <table class="tickets-table">
            <thead>
              <tr>
                <th>N√∫mero</th>
                <th>Disponibilidad</th>
              </tr>
            </thead>
            <tbody id="tickets-table-body">
            </tbody>
          </table>
        </div>
      </section>

      <!-- PAGOS -->
      <section class="payments">
        <div class="payments-card">
          <div class="payments-title">Cuentas en CHILE üá®üá±</div>
          <ul class="payments-list-vertical">
            <li>
              <strong>1. Leidy Saavedra</strong>
              RUT: 25.407.964-2<br>
              Banco Falabella ¬∑ Cuenta Corriente<br>
              N.¬∫ 1-983-252078-3
            </li>
            <li>
              <strong>2. Jeferson Valencia</strong>
              Banco Estado ¬∑ Cuenta Rut<br>
              N.¬∫ 26.196.885-1
            </li>
            <li>
              <strong>3. Leidy Saavedra</strong>
              Banco Estado ¬∑ Cuenta Rut<br>
              N.¬∫ 25.407.964-2
            </li>
          </ul>
          <div class="payments-note-small">
            Se recomienda realizar pagos principalmente a la cuenta de Falabella.
          </div>
        </div>

        <div class="payments-card">
          <div class="payments-title">Cuenta en COLOMBIA üá®üá¥</div>
          <ul class="payments-list-vertical">
            <li>
              <strong>1. Leidy Saavedra</strong>
              NEQUI<br>
              N.¬∫ 3118618775
            </li>
          </ul>
          <div class="payments-note-small">
            Se actualizan las cuentas por temas de fiscalizaci√≥n.
          </div>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="footer">
        Apuestas Martin's ¬∑ Boletas Chontico
      </footer>
    </div>
  </main>

  <!-- TRIGGER INVISIBLE PARA MODO ADMIN -->
  <div id="admin-trigger" aria-hidden="true"></div>

  <!-- PANEL ADMIN -->
  <div id="admin-panel" aria-hidden="true">
    <button id="admin-close" type="button" title="Cerrar">√ó</button>
    <div id="admin-panel-title">Modo administrador</div>
    <div id="admin-panel-note">
      Marca n√∫meros como disponibles u ocupados por categor√≠a.
    </div>
    <select id="admin-category"></select>
    <select id="admin-select"></select>
    <div id="admin-status"></div>
    <button id="admin-toggle-status" type="button" class="btn btn-secondary" style="width:100%; margin-top:4px;">
      Cambiar estado
    </button>
    <div style="margin-top:6px; font-size:10px; color:#9ca3af;">
      Atajo: <strong>Ctrl + Shift + A</strong>. Cambios guardados en este dispositivo.
    </div>
  </div>

  <script>
    (function () {
      const WHATSAPP_NUMBER = "573125172779";
      const TOTAL_NUMBERS = 100; // 00 a 99

      const CATEGORIES = [
        { id: "domingo-dia", label: "CHONTICO DOMINGO D√çA" },
        { id: "sab-dom-noche", label: "CHONTICO S√ÅBADO Y DOMINGO NOCHE" },
        { id: "lun-vie-noche", label: "CHONTICO DE LUNES A VIERNES NOCHE" },
        { id: "lun-sab-dia", label: "CHONTICO DE LUNES A S√ÅBADO D√çA" }
      ];

      const STORAGE_KEY = "boletasChonticoEstados_v3";

      const categorySelect = document.getElementById("category-select");
      const ticketSelect = document.getElementById("ticket-select");
      const finderCategoryLabel = document.getElementById("finder-category-label");
      const finderNumber = document.getElementById("finder-number");
      const finderStatusPill = document.getElementById("finder-status-pill");
      const finderInfo = document.getElementById("finder-info");
      const reserveButton = document.getElementById("reserve-button");
      const toggleTableBtn = document.getElementById("toggle-table");
      const tableWrapper = document.getElementById("tickets-table-wrapper");
      const tableBody = document.getElementById("tickets-table-body");

      const adminTrigger = document.getElementById("admin-trigger");
      const adminPanel = document.getElementById("admin-panel");
      const adminCategorySelect = document.getElementById("admin-category");
      const adminSelect = document.getElementById("admin-select");
      const adminStatus = document.getElementById("admin-status");
      const adminToggleStatus = document.getElementById("admin-toggle-status");
      const adminClose = document.getElementById("admin-close");

      let availability = {};

      function formatTicketNumber(n) {
        return n.toString().padStart(2, "0");
      }

      function loadAvailability() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            if (parsed && typeof parsed === "object") {
              availability = parsed;
            }
          } catch (e) {}
        }
        CATEGORIES.forEach(cat => {
          if (!Array.isArray(availability[cat.id]) || availability[cat.id].length !== TOTAL_NUMBERS) {
            availability[cat.id] = new Array(TOTAL_NUMBERS).fill("disponible");
          }
        });
      }

      function saveAvailability() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(availability));
        } catch (e) {}
      }

      function initCategorySelects() {
        CATEGORIES.forEach(cat => {
          const opt1 = document.createElement("option");
          opt1.value = cat.id;
          opt1.textContent = cat.label;
          categorySelect.appendChild(opt1);

          const opt2 = document.createElement("option");
          opt2.value = cat.id;
          opt2.textContent = cat.label;
          adminCategorySelect.appendChild(opt2);
        });
      }

      function initNumberSelects() {
        for (let i = 0; i < TOTAL_NUMBERS; i++) {
          const value = i.toString();
          const label = formatTicketNumber(i);

          const option1 = document.createElement("option");
          option1.value = value;
          option1.textContent = label;
          ticketSelect.appendChild(option1);

          const option2 = document.createElement("option");
          option2.value = value;
          option2.textContent = label;
          adminSelect.appendChild(option2);
        }
      }

      function getCurrentCategoryId() {
        return categorySelect.value || CATEGORIES[0].id;
      }

      function getCategoryLabelById(id) {
        const cat = CATEGORIES.find(c => c.id === id);
        return cat ? cat.label : id;
      }

      function updateFinderView() {
        const catId = getCurrentCategoryId();
        const catLabel = getCategoryLabelById(catId);
        finderCategoryLabel.textContent = catLabel;

        const index = parseInt(ticketSelect.value, 10);
        if (isNaN(index)) {
          finderNumber.textContent = "--";
          finderStatusPill.className = "finder-status-pill neutral";
          finderStatusPill.textContent = "Selecciona un n√∫mero para ver su disponibilidad";
          finderInfo.textContent = "Estado actual del n√∫mero.";
          reserveButton.classList.add("disabled");
          reserveButton.setAttribute("aria-disabled", "true");
          reserveButton.href = "#";
          return;
        }

        const numText = formatTicketNumber(index);
        const status = availability[catId][index];

        finderNumber.textContent = numText;

        finderStatusPill.classList.remove("ok", "out", "neutral");
        if (status === "ocupado") {
          finderStatusPill.classList.add("out");
          finderStatusPill.textContent = "Ocupado";
          finderInfo.textContent = "N√∫mero ocupado.";
          reserveButton.classList.add("disabled");
          reserveButton.setAttribute("aria-disabled", "true");
          reserveButton.href = "#";
        } else {
          finderStatusPill.classList.add("ok");
          finderStatusPill.textContent = "Disponible";
          finderInfo.textContent = "N√∫mero disponible.";
          const message = `Hola, quiero apartar el numero de boleta ${numText} de ${catLabel}`;
          const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
          reserveButton.href = url;
          reserveButton.classList.remove("disabled");
          reserveButton.setAttribute("aria-disabled", "false");
        }
      }

      function buildTable() {
        const catId = getCurrentCategoryId();
        tableBody.innerHTML = "";
        for (let i = 0; i < TOTAL_NUMBERS; i++) {
          const tr = document.createElement("tr");
          const tdNum = document.createElement("td");
          const tdStatus = document.createElement("td");

          tdNum.textContent = formatTicketNumber(i);

          const span = document.createElement("span");
          span.classList.add("badge-status");
          if (availability[catId][i] === "ocupado") {
            span.classList.add("out");
            span.textContent = "Ocupado";
          } else {
            span.classList.add("ok");
            span.textContent = "Disponible";
          }
          tdStatus.appendChild(span);

          tr.appendChild(tdNum);
          tr.appendChild(tdStatus);
          tableBody.appendChild(tr);
        }
      }

      function updateAdminView() {
        const catId = adminCategorySelect.value || CATEGORIES[0].id;
        const index = parseInt(adminSelect.value, 10);
        if (isNaN(index)) {
          adminStatus.textContent = "";
          return;
        }
        const status = availability[catId][index];
        adminStatus.textContent =
          `Categor√≠a: ${getCategoryLabelById(catId)} ¬∑ N√∫mero ${formatTicketNumber(index)} ¬∑ Estado: ${status === "ocupado" ? "Ocupado" : "Disponible"}`;
        adminToggleStatus.textContent = status === "ocupado" ? "Marcar como disponible" : "Marcar como ocupado";
      }

      function toggleAdminPanel(show) {
        const visible = show !== undefined ? show : adminPanel.style.display !== "block";
        adminPanel.style.display = visible ? "block" : "none";
      }

      loadAvailability();
      initCategorySelects();
      initNumberSelects();

      categorySelect.value = CATEGORIES[0].id;
      adminCategorySelect.value = CATEGORIES[0].id;
      ticketSelect.selectedIndex = 0;
      adminSelect.selectedIndex = 0;

      updateFinderView();
      buildTable();
      updateAdminView();

      categorySelect.addEventListener("change", function () {
        updateFinderView();
        buildTable();
      });

      ticketSelect.addEventListener("change", function () {
        updateFinderView();
      });

      toggleTableBtn.addEventListener("click", function () {
        const isVisible = tableWrapper.style.display === "block";
        tableWrapper.style.display = isVisible ? "none" : "block";
        tableWrapper.setAttribute("aria-hidden", isVisible ? "true" : "false");
        toggleTableBtn.textContent = isVisible ? "Ver lista completa de n√∫meros" : "Ocultar lista completa";
      });

      adminCategorySelect.addEventListener("change", function () {
        updateAdminView();
      });

      adminSelect.addEventListener("change", function () {
        updateAdminView();
      });

      adminToggleStatus.addEventListener("click", function () {
        const catId = adminCategorySelect.value || CATEGORIES[0].id;
        const index = parseInt(adminSelect.value, 10);
        if (isNaN(index)) return;
        availability[catId][index] = availability[catId][index] === "ocupado" ? "disponible" : "ocupado";
        saveAvailability();
        updateAdminView();
        updateFinderView();
        buildTable();
      });

      adminTrigger.addEventListener("click", function () {
        toggleAdminPanel();
      });

      adminClose.addEventListener("click", function () {
        toggleAdminPanel(false);
      });

      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey && e.shiftKey && (e.key === "A" || e.key === "a")) {
          e.preventDefault();
          toggleAdminPanel();
        }
      });
    })();
  </script>
</body>
</html>
