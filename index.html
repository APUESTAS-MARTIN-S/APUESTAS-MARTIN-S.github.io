<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Apuestas Martin's ‚Äì Boletas Chontico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #022c22;
      --card: #021813;
      --accent: #22c55e;
      --accent-strong: #16a34a;
      --ok: #22c55e;
      --danger: #ef4444;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(34,197,94,0.45);
      --shadow-soft: 0 18px 35px rgba(4, 23, 16, 0.85);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #047857 0, #022c22 45%, #01100c 100%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    main {
      width: 100%;
      max-width: 1080px;
      background: linear-gradient(145deg, rgba(6,78,59,0.98), rgba(3,47,36,0.99));
      border-radius: 26px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 20px 18px 18px;
      position: relative;
      overflow: hidden;
    }

    main::before,
    main::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      filter: blur(45px);
      opacity: 0.35;
      pointer-events: none;
    }

    main::before {
      width: 260px;
      height: 260px;
      background: radial-gradient(circle, rgba(34,197,94,0.7), transparent 60%);
      top: -90px;
      right: -70px;
    }

    main::after {
      width: 240px;
      height: 240px;
      background: radial-gradient(circle, rgba(21,128,61,0.7), transparent 60%);
      bottom: -80px;
      left: -40px;
    }

    .content {
      position: relative;
      z-index: 1;
    }

    /* BANNER CON LOGO */
    .banner {
      border-radius: 22px;
      overflow: hidden;
      border: 1px solid rgba(22,163,74,0.7);
      box-shadow: 0 14px 32px rgba(4,20,14,0.95);
      margin-bottom: 18px;
      background: #064e3b;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px 10px;
    }

    .banner-img {
      width: 100%;
      max-height: 260px;
      object-fit: contain;
      display: block;
    }

    /* MARCA */
    .header-brand {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 18px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark-img {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(34,197,94,0.65);
      box-shadow: 0 0 0 1px rgba(3,24,17,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      background: #064e3b;
    }

    .logo-mark-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .logo-text-main {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: 18px;
      letter-spacing: 0.03em;
    }

    .logo-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .tag-age {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(1,17,13,0.96);
      border: 1px solid rgba(22,163,74,0.7);
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .tag-age span.badge {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(248,250,252,0.06);
      color: #e5e7eb;
      font-size: 11px;
      font-weight: 600;
    }

    @media (max-width: 640px) {
      .header-brand {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* HERO VALORES */
    .hero {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.1fr);
      gap: 20px;
      margin-bottom: 18px;
    }

    @media (max-width: 820px) {
      .hero {
        grid-template-columns: 1fr;
      }
    }

    .hero-left {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(3,24,17,0.9);
      border: 1px solid rgba(34,197,94,0.7);
      font-size: 11px;
      color: var(--text-muted);
      width: fit-content;
    }

    .eyebrow span {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #e5e7eb;
    }

    .title {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: clamp(24px, 3.6vw, 30px);
      line-height: 1.2;
      letter-spacing: 0.01em;
    }

    .title strong {
      color: var(--accent);
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-muted);
      max-width: 520px;
    }

    .hero-right {
      background: rgba(1,17,13,0.96);
      border-radius: 18px;
      border: 1px solid rgba(22,163,74,0.7);
      padding: 12px 12px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hero-right-title {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(1,17,13,1);
      border: 1px solid rgba(22,163,74,0.6);
      font-size: 11px;
      color: #e5e7eb;
    }

    .pill strong {
      color: var(--accent);
      font-weight: 600;
    }

    /* BUSCADOR + LISTA */
    .finder-section {
      background: rgba(1,17,13,0.98);
      border-radius: 18px;
      border: 1px solid rgba(22,163,74,0.7);
      padding: 12px 12px 14px;
      margin-bottom: 18px;
    }

    .finder-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 10px;
    }

    .finder-title {
      font-size: 15px;
      font-weight: 600;
    }

    .finder-note {
      font-size: 12px;
      color: var(--text-muted);
    }

    @media (max-width: 640px) {
      .finder-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .finder-controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 10px;
    }

    .finder-label {
      font-size: 13px;
    }

    .finder-select {
      min-width: 140px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      background: #02130f;
      color: var(--text-main);
      font-size: 14px;
    }

    .finder-select:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px var(--accent-strong);
    }

    .finder-result {
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 1.1fr);
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    @media (max-width: 720px) {
      .finder-result {
        grid-template-columns: 1fr;
      }
    }

    .finder-card {
      background: #020f0b;
      border-radius: 14px;
      border: 1px solid rgba(12,83,52,0.96);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .finder-number-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .finder-number {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: 26px;
    }

    .finder-status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid transparent;
    }

    .finder-status-pill.ok {
      background: rgba(22,163,74,0.18);
      border-color: rgba(34,197,94,0.8);
      color: #bbf7d0;
    }

    .finder-status-pill.out {
      background: rgba(248,113,113,0.16);
      border-color: rgba(248,113,113,0.9);
      color: #fee2e2;
    }

    .finder-status-pill.res {
      background: rgba(250,204,21,0.16);
      border-color: rgba(250,204,21,0.9);
      color: #fef3c7;
    }

    .finder-status-pill.neutral {
      background: rgba(1,17,13,0.9);
      border-color: rgba(148,163,184,0.6);
      color: var(--text-muted);
    }

    .finder-info {
      font-size: 12px;
      color: var(--text-muted);
    }

    .finder-number-picker {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .finder-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }

    /* DINO ENCIMA DE BOTONES */
    .dino-inline-img {
      max-width: 230px;
      width: 100%;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(34,197,94,0.7);
      box-shadow: 0 10px 22px rgba(2,23,16,0.9);
      background: #022c22;
    }

    .dino-inline-img img {
      width: 100%;
      display: block;
      object-fit: cover;
    }

    /* BOTONES */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 9px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, background 0.1s ease-out, border-color 0.1s ease-out, opacity 0.1s ease-out;
      white-space: nowrap;
      width: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      box-shadow: 0 12px 25px rgba(22,163,74,0.6);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(22,163,74,0.8);
    }

    .btn-primary.disabled {
      opacity: 0.5;
      box-shadow: none;
      cursor: default;
      transform: none;
    }

    .btn-secondary {
      background: rgba(1,17,13,0.95);
      border-color: rgba(148,163,184,0.5);
      color: var(--text-main);
      font-size: 12px;
      padding: 7px 12px;
    }

    .btn-secondary:hover {
      background: rgba(1,20,15,0.98);
      border-color: #e5e7eb;
    }

    /* TABLA INTERACTIVA 00‚Äì99 */
    .tickets-table-wrapper {
      margin-top: 8px;
      max-height: 360px;
      overflow: auto;
      border-radius: 12px;
      border: 1px solid rgba(7,43,29,0.95);
      background: #020f0b;
    }

    .tickets-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .tickets-table thead {
      position: sticky;
      top: 0;
      background: #059669;
      z-index: 1;
    }

    .tickets-table th,
    .tickets-table td {
      padding: 7px 8px;
      text-align: left;
    }

    .tickets-table th {
      font-weight: 600;
      color: #f9fafb;
      border-bottom: 1px solid #022c22;
    }

    .tickets-table tbody tr:nth-child(even) {
      background: #020f0b;
    }

    .tickets-table tbody tr:nth-child(odd) {
      background: #031611;
    }

    .num-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 52px;
      padding: 6px 0;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      background: radial-gradient(circle at 30% 20%, #065f46, #022c22);
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: 15px;
      cursor: pointer;
    }

    .num-pill.selected {
      box-shadow: 0 0 0 2px #ecfeff, 0 0 0 3px #22c55e;
    }

    .cell-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: #020f0b;
      color: var(--text-main);
      padding: 5px 8px;
      font-size: 12px;
    }

    .cell-input:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px var(--accent-strong);
    }

    .badge-status {
      display: inline-block;
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid transparent;
      text-align: center;
      min-width: 80px;
    }

    .badge-status.disponible {
      background: rgba(22,163,74,0.18);
      border-color: rgba(34,197,94,0.8);
      color: #bbf7d0;
    }

    .badge-status.reservado {
      background: rgba(251,191,36,0.16);
      border-color: rgba(250,204,21,0.9);
      color: #fef3c7;
    }

    .badge-status.pagado {
      background: rgba(37,99,235,0.18);
      border-color: rgba(37,99,235,0.9);
      color: #dbeafe;
    }

    .btn-row {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #f9fafb;
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-row.disabled {
      opacity: 0.5;
      cursor: default;
      background: #1f2937;
      border-color: rgba(107,114,128,0.8);
    }

    .hint-cell {
      font-size: 10px;
      color: var(--text-muted);
      padding-top: 4px;
    }

    /* PAGOS */
    .payments {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 14px;
      margin-bottom: 10px;
    }

    @media (max-width: 780px) {
      .payments {
        grid-template-columns: 1fr;
      }
    }

    .payments-card {
      background: rgba(1,17,13,0.98);
      border-radius: 16px;
      border: 1px solid rgba(22,163,74,0.7);
      padding: 10px 12px 9px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
    }

    .payments-title {
      font-size: 14px;
      font-weight: 600;
    }

    .payments-list-vertical {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .payments-list-vertical li {
      padding: 6px 8px;
      border-radius: 10px;
      background: var(--card);
      border: 1px solid rgba(22,163,74,0.7);
      line-height: 1.4;
    }

    .payments-list-vertical strong {
      display: block;
      margin-bottom: 2px;
    }

    .payments-note-small {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* FOOTER */
    .footer {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }

    /* ADMIN */
    #admin-trigger {
      position: fixed;
      bottom: 4px;
      right: 4px;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      opacity: 0;
      cursor: pointer;
      z-index: 50;
    }

    #admin-panel {
      position: fixed;
      bottom: 14px;
      right: 14px;
      width: 290px;
      max-width: calc(100% - 28px);
      background: #020f0b;
      border-radius: 14px;
      border: 1px solid rgba(22,163,74,0.7);
      box-shadow: 0 16px 32px rgba(1,15,11,0.95);
      padding: 10px 12px 12px;
      font-size: 12px;
      color: var(--text-main);
      z-index: 60;
      display: none;
    }

    #admin-panel-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    #admin-panel-note {
      color: var(--text-muted);
      font-size: 11px;
      margin-bottom: 6px;
    }

    .admin-select {
      width: 100%;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      background: #02130f;
      color: var(--text-main);
      font-size: 12px;
      margin-bottom: 6px;
    }

    .admin-select:focus {
      outline: none;
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px var(--accent-strong);
    }

    #admin-status {
      margin-bottom: 6px;
    }

    .admin-buttons {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 4px;
      margin-bottom: 6px;
    }

    .admin-btn-small {
      padding: 5px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: #020f0b;
      color: #e5e7eb;
      font-size: 11px;
      cursor: pointer;
    }

    .admin-btn-small:hover {
      background: #022c22;
    }

    #admin-export {
      width: 100%;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      background: #022c22;
      color: #bbf7d0;
      font-size: 11px;
      cursor: pointer;
    }

    #admin-export:hover {
      background: #065f46;
    }

    #admin-close {
      position: absolute;
      top: 4px;
      right: 8px;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
    }

    #admin-close:hover {
      color: #e5e7eb;
    }
  </style>
</head>
<body>
  <main>
    <div class="content">
      <!-- BANNER CON LOGO (logo.jpeg en la misma carpeta) -->
      <section class="banner">
        <img src="logo.jpeg" alt="Apuestas Martin's" class="banner-img">
      </section>

      <!-- MARCA -->
      <header class="header-brand">
        <div class="logo">
          <div class="logo-mark-img">
            <img src="dino.jpg" alt="Dino Martin's">
          </div>
          <div>
            <div class="logo-text-main">Apuestas Martin's</div>
            <div class="logo-text-sub">Boletas Chontico</div>
          </div>
        </div>
        <div class="tag-age">
          <span class="badge">+18</span>
          <span>Solo mayores de edad</span>
        </div>
      </header>

      <!-- VALORES -->
      <section class="hero">
        <div class="hero-left">
          <div class="eyebrow">
            <span>Boletas Chontico</span>
          </div>
          <h2 class="title">
            Valores en <strong>CLP</strong> y <strong>COP</strong>.
          </h2>
          <p class="subtitle">
            Elige el tipo (d√≠a o noche), el d√≠a de la semana y aparta un n√∫mero del 00 al 99.
          </p>
        </div>

        <aside class="hero-right">
          <div class="hero-right-title">Valores por tipo de boleta</div>
          <div class="pill-row">
            <div class="pill">
              <strong>CHONTICO D√çA</strong><br>
              <span>Lunes a S√°bado: $2.000 CLP ¬∑ $8.000 COP<br>Domingo: $1.000 CLP ¬∑ $4.000 COP</span>
            </div>
            <div class="pill">
              <strong>CHONTICO NOCHE</strong><br>
              <span>Lunes a Viernes: $2.000 CLP ¬∑ $8.000 COP<br>S√°bado y Domingo: $3.000 CLP ¬∑ $12.000 COP</span>
            </div>
          </div>
        </aside>
      </section>

      <!-- SECCI√ìN PRINCIPAL -->
      <section class="finder-section">
        <div class="finder-header">
          <h3 class="finder-title">N√∫mero de boleta</h3>
          <p class="finder-note">
            Chontico D√≠a y Noche ¬∑ Listas independientes por d√≠a ¬∑ N√∫meros del 00 al 99.
          </p>
        </div>

        <div class="finder-controls-row">
          <span class="finder-label">Tipo:</span>
          <select id="tipo-select" class="finder-select"></select>

          <span class="finder-label">D√≠a:</span>
          <select id="dia-select" class="finder-select"></select>
        </div>

        <div class="finder-result">
          <div class="finder-card">
            <div class="finder-number-label">Tipo seleccionado</div>
            <div id="finder-tipo-label" class="finder-info">‚Äî</div>

            <div class="finder-number-label">D√≠a seleccionado</div>
            <div id="finder-dia-label" class="finder-info">‚Äî</div>

            <div class="finder-number-label">N√∫mero seleccionado</div>
            <div id="finder-number" class="finder-number">--</div>

            <div id="finder-status-pill" class="finder-status-pill neutral">
              Toca un n√∫mero en la lista para ver su estado.
            </div>
            <div id="finder-info" class="finder-info">
              Estado actual del n√∫mero.
            </div>

            <div class="finder-number-picker">
              N√∫meros de la lista: 00 al 99.
            </div>
          </div>

          <div class="finder-actions">
            <div class="dino-inline-img">
              <img src="dino.jpg" alt="Dino Martin's">
            </div>
            <a id="reserve-button" href="#" target="_blank" class="btn btn-primary disabled" aria-disabled="true">
              Reservar por WhatsApp
            </a>
            <button id="clear-selection" type="button" class="btn btn-secondary">
              Limpiar selecci√≥n
            </button>
          </div>
        </div>

        <!-- TABLA INTERACTIVA -->
        <div class="tickets-table-wrapper" id="tickets-table-wrapper">
          <table class="tickets-table">
            <thead>
              <tr>
                <th style="width:70px;">N√∫mero</th>
                <th>Nombre</th>
                <th>Celular</th>
                <th style="width:110px;">Estado</th>
                <th style="width:110px;">Acci√≥n</th>
              </tr>
            </thead>
            <tbody id="tickets-table-body">
            </tbody>
          </table>
        </div>
        <div class="hint-cell">
          Celular: 9 d√≠gitos (Chile) o 10 d√≠gitos (Colombia). Solo n√∫meros.
        </div>
      </section>

      <!-- PAGOS -->
      <section class="payments">
        <div class="payments-card">
          <div class="payments-title">Cuentas en CHILE üá®üá±</div>
          <ul class="payments-list-vertical">
            <li>
              <strong>1. Leidy Saavedra</strong>
              RUT: 25.407.964-2<br>
              Banco Falabella ¬∑ Cuenta Corriente<br>
              N.¬∫ 1-983-252078-3
            </li>
            <li>
              <strong>2. Jeferson Valencia</strong>
              Banco Estado ¬∑ Cuenta Rut<br>
              N.¬∫ 26.196.885-1
            </li>
            <li>
              <strong>3. Leidy Saavedra</strong>
              Banco Estado ¬∑ Cuenta Rut<br>
              N.¬∫ 25.407.964-2
            </li>
          </ul>
          <div class="payments-note-small">
            Se recomienda realizar pagos principalmente a la cuenta de Falabella.
          </div>
        </div>

        <div class="payments-card">
          <div class="payments-title">Cuenta en COLOMBIA üá®üá¥</div>
          <ul class="payments-list-vertical">
            <li>
              <strong>1. Leidy Saavedra</strong>
              NEQUI<br>
              N.¬∫ 3118618775
            </li>
          </ul>
          <div class="payments-note-small">
            Se actualizan las cuentas por temas de fiscalizaci√≥n.
          </div>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="footer">
        Apuestas Martin's ¬∑ Boletas Chontico
      </footer>
    </div>
  </main>

  <!-- TRIGGER INVISIBLE PARA MODO ADMIN -->
  <div id="admin-trigger" aria-hidden="true"></div>

  <!-- PANEL ADMIN -->
  <div id="admin-panel" aria-hidden="true">
    <button id="admin-close" type="button" title="Cerrar">√ó</button>
    <div id="admin-panel-title">Modo administrador</div>
    <div id="admin-panel-note">
      Cambia estados, limpia datos y descarga reservas en CSV (Excel). Atajo: <strong>Ctrl + Shift + A</strong>.
    </div>

    <select id="admin-tipo" class="admin-select"></select>
    <select id="admin-dia" class="admin-select"></select>
    <select id="admin-select" class="admin-select"></select>

    <div id="admin-status"></div>

    <div class="admin-buttons">
      <button id="admin-disponible" class="admin-btn-small">Disponible</button>
      <button id="admin-reservado" class="admin-btn-small">Reservado</button>
      <button id="admin-pagado" class="admin-btn-small">Pagado</button>
    </div>
    <button id="admin-clear-name" class="admin-btn-small" style="width:100%; margin-bottom:6px;">
      Borrar nombre y celular
    </button>

    <button id="admin-export">Descargar CSV (Excel)</button>
  </div>

  <script>
    (function () {
      const WHATSAPP_NUMBER = "573125172779";
      const TOTAL_NUMBERS = 100; // 00‚Äì99
      const STORAGE_KEY = "boletasChonticoEstados_v5";

      const TIPOS = [
        { id: "dia",   label: "Chontico D√≠a" },
        { id: "noche", label: "Chontico Noche" }
      ];

      const DIAS = [
        { id: "lun", label: "Lunes" },
        { id: "mar", label: "Martes" },
        { id: "mie", label: "Mi√©rcoles" },
        { id: "jue", label: "Jueves" },
        { id: "vie", label: "Viernes" },
        { id: "sab", label: "S√°bado" },
        { id: "dom", label: "Domingo" }
      ];

      const ESTADOS = {
        DISPONIBLE: "disponible",
        RESERVADO: "reservado",
        PAGADO: "pagado"
      };

      const tipoSelect = document.getElementById("tipo-select");
      const diaSelect = document.getElementById("dia-select");

      const finderTipoLabel = document.getElementById("finder-tipo-label");
      const finderDiaLabel = document.getElementById("finder-dia-label");
      const finderNumber = document.getElementById("finder-number");
      const finderStatusPill = document.getElementById("finder-status-pill");
      const finderInfo = document.getElementById("finder-info");
      const clearSelectionBtn = document.getElementById("clear-selection");
      const reserveButton = document.getElementById("reserve-button");

      const tableBody = document.getElementById("tickets-table-body");

      const adminTrigger = document.getElementById("admin-trigger");
      const adminPanel = document.getElementById("admin-panel");
      const adminTipoSelect = document.getElementById("admin-tipo");
      const adminDiaSelect = document.getElementById("admin-dia");
      const adminSelect = document.getElementById("admin-select");
      const adminStatus = document.getElementById("admin-status");
      const adminDisponible = document.getElementById("admin-disponible");
      const adminReservado = document.getElementById("admin-reservado");
      const adminPagado = document.getElementById("admin-pagado");
      const adminClearName = document.getElementById("admin-clear-name");
      const adminExport = document.getElementById("admin-export");
      const adminClose = document.getElementById("admin-close");

      let data = {}; // data[tipoId][diaId][index] = {estado, nombre, celular}
      let selectedIndex = null;

      function formatNumber(n) {
        return n.toString().padStart(2, "0");
      }

      function ensureStructure() {
        TIPOS.forEach(t => {
          if (!data[t.id]) data[t.id] = {};
          DIAS.forEach(d => {
            if (!Array.isArray(data[t.id][d.id]) || data[t.id][d.id].length !== TOTAL_NUMBERS) {
              const arr = new Array(TOTAL_NUMBERS);
              for (let i = 0; i < TOTAL_NUMBERS; i++) {
                arr[i] = { estado: ESTADOS.DISPONIBLE, nombre: "", celular: "" };
              }
              data[t.id][d.id] = arr;
            }
          });
        });
      }

      function loadData() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            if (parsed && typeof parsed === "object") {
              data = parsed;
            }
          } catch (e) {}
        }
        ensureStructure();
      }

      function saveData() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        } catch (e) {}
      }

      function initSelectors() {
        TIPOS.forEach(t => {
          const opt = document.createElement("option");
          opt.value = t.id;
          opt.textContent = t.label;
          tipoSelect.appendChild(opt);

          const optAdmin = document.createElement("option");
          optAdmin.value = t.id;
          optAdmin.textContent = t.label;
          adminTipoSelect.appendChild(optAdmin);
        });

        DIAS.forEach(d => {
          const opt = document.createElement("option");
          opt.value = d.id;
          opt.textContent = d.label;
          diaSelect.appendChild(opt);

          const optAdmin = document.createElement("option");
          optAdmin.value = d.id;
          optAdmin.textContent = d.label;
          adminDiaSelect.appendChild(optAdmin);
        });

        for (let i = 0; i < TOTAL_NUMBERS; i++) {
          const optAdmin = document.createElement("option");
          optAdmin.value = String(i);
          optAdmin.textContent = formatNumber(i);
          adminSelect.appendChild(optAdmin);
        }

        tipoSelect.value = TIPOS[0].id;
        diaSelect.value = DIAS[0].id;
        adminTipoSelect.value = TIPOS[0].id;
        adminDiaSelect.value = DIAS[0].id;
        adminSelect.value = "0";
      }

      function currentTipoId() {
        return tipoSelect.value || TIPOS[0].id;
      }

      function currentDiaId() {
        return diaSelect.value || DIAS[0].id;
      }

      function labelTipo(id) {
        const t = TIPOS.find(x => x.id === id);
        return t ? t.label : id;
      }

      function labelDia(id) {
        const d = DIAS.find(x => x.id === id);
        return d ? d.label : id;
      }

      function refreshFinderLabels() {
        const tId = currentTipoId();
        const dId = currentDiaId();
        finderTipoLabel.textContent = labelTipo(tId);
        finderDiaLabel.textContent = labelDia(dId);
      }

      function statusToText(estado) {
        if (estado === ESTADOS.RESERVADO) return "Reservado";
        if (estado === ESTADOS.PAGADO) return "Pagado";
        return "Disponible";
      }

      function updateFinderFromSelection() {
        const tId = currentTipoId();
        const dId = currentDiaId();
        refreshFinderLabels();

        if (selectedIndex == null) {
          finderNumber.textContent = "--";
          finderStatusPill.className = "finder-status-pill neutral";
          finderStatusPill.textContent = "Toca un n√∫mero en la lista para ver su estado.";
          finderInfo.textContent = "Estado actual del n√∫mero.";
          reserveButton.classList.add("disabled");
          reserveButton.setAttribute("aria-disabled", "true");
          reserveButton.href = "#";
          return;
        }

        const registro = data[tId][dId][selectedIndex];
        const numText = formatNumber(selectedIndex);
        finderNumber.textContent = numText;

        finderStatusPill.classList.remove("ok", "out", "res", "neutral");
        if (registro.estado === ESTADOS.DISPONIBLE) {
          finderStatusPill.classList.add("ok");
          finderStatusPill.textContent = "Disponible";
          finderInfo.textContent = "N√∫mero disponible para ser reservado.";
        } else if (registro.estado === ESTADOS.RESERVADO) {
          finderStatusPill.classList.add("res");
          finderStatusPill.textContent = "Reservado";
          finderInfo.textContent = "N√∫mero reservado. Pendiente de pago o confirmaci√≥n.";
        } else {
          finderStatusPill.classList.add("out");
          finderStatusPill.textContent = "Pagado";
          finderInfo.textContent = "N√∫mero pagado y confirmado.";
        }

        const msgName = registro.nombre ? ` para ${registro.nombre}` : "";
        const message =
          `Hola, quiero informaci√≥n sobre la boleta ${numText} de ${labelTipo(tId)} (${labelDia(dId)})${msgName}.`;

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
        reserveButton.href = url;
        reserveButton.classList.remove("disabled");
        reserveButton.setAttribute("aria-disabled", "false");
      }

      function validatePhone(value) {
        const clean = value.replace(/\D/g, "");
        if (clean.length === 9 || clean.length === 10) {
          return clean;
        }
        return null;
      }

      function buildRow(tipoId, diaId, index) {
        const registro = data[tipoId][diaId][index];
        const tr = document.createElement("tr");
        tr.dataset.index = String(index);

        const tdNum = document.createElement("td");
        const numBtn = document.createElement("button");
        numBtn.type = "button";
        numBtn.className = "num-pill";
        numBtn.textContent = formatNumber(index);
        tdNum.appendChild(numBtn);

        const tdNombre = document.createElement("td");
        const inputNombre = document.createElement("input");
        inputNombre.type = "text";
        inputNombre.className = "cell-input";
        inputNombre.value = registro.nombre || "";
        inputNombre.placeholder = "Nombre";
        tdNombre.appendChild(inputNombre);

        const tdCel = document.createElement("td");
        const inputCel = document.createElement("input");
        inputCel.type = "tel";
        inputCel.className = "cell-input";
        inputCel.value = registro.celular || "";
        inputCel.placeholder = "Ej: 912345678 / 3001234567";
        tdCel.appendChild(inputCel);

        const tdEstado = document.createElement("td");
        const spanEstado = document.createElement("span");
        spanEstado.className = "badge-status " + registro.estado;
        spanEstado.textContent = statusToText(registro.estado);
        tdEstado.appendChild(spanEstado);

        const tdAccion = document.createElement("td");
        const btnAccion = document.createElement("button");
        btnAccion.type = "button";
        btnAccion.className = "btn-row";
        btnAccion.textContent = "Apartar";

        if (registro.estado !== ESTADOS.DISPONIBLE) {
          btnAccion.textContent = registro.estado === ESTADOS.RESERVADO ? "Reservado" : "Pagado";
          btnAccion.classList.add("disabled");
        }

        tdAccion.appendChild(btnAccion);

        tr.appendChild(tdNum);
        tr.appendChild(tdNombre);
        tr.appendChild(tdCel);
        tr.appendChild(tdEstado);
        tr.appendChild(tdAccion);

        numBtn.addEventListener("click", function () {
          selectedIndex = index;
          highlightSelected();
          updateFinderFromSelection();
        });

        btnAccion.addEventListener("click", function () {
          if (registro.estado !== ESTADOS.DISPONIBLE) return;

          const nombre = inputNombre.value.trim();
          const celRaw = inputCel.value.trim();
          if (!nombre) {
            alert("Por favor escribe un nombre para apartar la boleta.");
            return;
          }
          const celValid = validatePhone(celRaw);
          if (!celValid) {
            alert("El celular debe tener 9 d√≠gitos (Chile) o 10 d√≠gitos (Colombia), solo n√∫meros.");
            return;
          }

          registro.nombre = nombre;
          registro.celular = celValid;
          registro.estado = ESTADOS.RESERVADO;
          spanEstado.className = "badge-status " + registro.estado;
          spanEstado.textContent = statusToText(registro.estado);
          btnAccion.textContent = "Reservado";
          btnAccion.classList.add("disabled");

          saveData();

          selectedIndex = index;
          highlightSelected();
          updateFinderFromSelection();

          const tId = currentTipoId();
          const dId = currentDiaId();
          const message =
            `Hola, quiero apartar el n√∫mero ${formatNumber(index)} de ${labelTipo(tId)} (${labelDia(dId)}).\n` +
            `Nombre: ${nombre}\nCelular: ${celValid}`;
          const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
          window.open(url, "_blank");
        });

        inputNombre.addEventListener("change", function () {
          registro.nombre = inputNombre.value.trim();
          saveData();
          if (selectedIndex === index) updateFinderFromSelection();
        });

        inputCel.addEventListener("change", function () {
          registro.celular = inputCel.value.trim();
          saveData();
          if (selectedIndex === index) updateFinderFromSelection();
        });

        return tr;
      }

      function highlightSelected() {
        const rows = tableBody.querySelectorAll("tr");
        rows.forEach(row => {
          const idx = parseInt(row.dataset.index, 10);
          const pill = row.querySelector(".num-pill");
          if (!pill) return;
          if (selectedIndex === idx) {
            pill.classList.add("selected");
          } else {
            pill.classList.remove("selected");
          }
        });
      }

      function rebuildTable() {
        const tId = currentTipoId();
        const dId = currentDiaId();
        tableBody.innerHTML = "";
        for (let i = 0; i < TOTAL_NUMBERS; i++) {
          tableBody.appendChild(buildRow(tId, dId, i));
        }
        highlightSelected();
      }

      function clearSelection() {
        selectedIndex = null;
        highlightSelected();
        updateFinderFromSelection();
      }

      /* ADMIN */

      function toggleAdminPanel(show) {
        const visible = show !== undefined ? show : adminPanel.style.display !== "block";
        adminPanel.style.display = visible ? "block" : "none";
      }

      function currentAdminTipo() {
        return adminTipoSelect.value || TIPOS[0].id;
      }

      function currentAdminDia() {
        return adminDiaSelect.value || DIAS[0].id;
      }

      function currentAdminIndex() {
        const idx = parseInt(adminSelect.value, 10);
        return isNaN(idx) ? 0 : idx;
      }

      function updateAdminStatus() {
        const tId = currentAdminTipo();
        const dId = currentAdminDia();
        const idx = currentAdminIndex();
        const registro = data[tId][dId][idx];

        adminStatus.textContent =
          `Tipo: ${labelTipo(tId)} ¬∑ D√≠a: ${labelDia(dId)} ¬∑ N¬∫ ${formatNumber(idx)} ¬∑ ` +
          `Estado: ${statusToText(registro.estado)} ¬∑ Nombre: ${registro.nombre || "-"} ¬∑ Celular: ${registro.celular || "-"}`;
      }

      adminTipoSelect.addEventListener("change", updateAdminStatus);
      adminDiaSelect.addEventListener("change", updateAdminStatus);
      adminSelect.addEventListener("change", updateAdminStatus);

      function adminSetEstado(estado) {
        const tId = currentAdminTipo();
        const dId = currentAdminDia();
        const idx = currentAdminIndex();
        const registro = data[tId][dId][idx];
        registro.estado = estado;
        saveData();
        updateAdminStatus();

        if (tId === currentTipoId() && dId === currentDiaId()) {
          rebuildTable();
          if (selectedIndex === idx) updateFinderFromSelection();
        }
      }

      adminDisponible.addEventListener("click", function () {
        const tId = currentAdminTipo();
        const dId = currentAdminDia();
        const idx = currentAdminIndex();
        const registro = data[tId][dId][idx];
        registro.estado = ESTADOS.DISPONIBLE;
        registro.nombre = "";
        registro.celular = "";
        saveData();
        updateAdminStatus();
        if (tId === currentTipoId() && dId === currentDiaId()) {
          rebuildTable();
          if (selectedIndex === idx) clearSelection();
        }
      });

      adminReservado.addEventListener("click", function () {
        adminSetEstado(ESTADOS.RESERVADO);
      });

      adminPagado.addEventListener("click", function () {
        adminSetEstado(ESTADOS.PAGADO);
      });

      adminClearName.addEventListener("click", function () {
        const tId = currentAdminTipo();
        const dId = currentAdminDia();
        const idx = currentAdminIndex();
        const registro = data[tId][dId][idx];
        registro.nombre = "";
        registro.celular = "";
        saveData();
        updateAdminStatus();
        if (tId === currentTipoId() && dId === currentDiaId()) {
          rebuildTable();
          if (selectedIndex === idx) updateFinderFromSelection();
        }
      });

      adminExport.addEventListener("click", function () {
        const rows = [];
        TIPOS.forEach(t => {
          DIAS.forEach(d => {
            data[t.id][d.id].forEach((reg, idx) => {
              if (reg.estado !== ESTADOS.DISPONIBLE || reg.nombre || reg.celular) {
                rows.push({
                  tipo: labelTipo(t.id),
                  dia: labelDia(d.id),
                  numero: formatNumber(idx),
                  estado: statusToText(reg.estado),
                  nombre: reg.nombre || "",
                  celular: reg.celular || ""
                });
              }
            });
          });
        });

        if (rows.length === 0) {
          alert("No hay reservas para exportar.");
          return;
        }

        let csv = "Tipo;D√≠a;N√∫mero;Estado;Nombre;Celular\r\n";
        rows.forEach(r => {
          csv += `${r.tipo};${r.dia};${r.numero};${r.estado};${r.nombre};${r.celular}\r\n`;
        });

        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "reservas_chontico.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });

      adminTrigger.addEventListener("click", function () {
        toggleAdminPanel();
      });

      adminClose.addEventListener("click", function () {
        toggleAdminPanel(false);
      });

      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey && e.shiftKey && (e.key === "A" || e.key === "a")) {
          e.preventDefault();
          toggleAdminPanel();
        }
      });

      /* INICIALIZACI√ìN GENERAL */
      loadData();
      initSelectors();
      refreshFinderLabels();
      rebuildTable();
      updateFinderFromSelection();
      updateAdminStatus();

      tipoSelect.addEventListener("change", function () {
        clearSelection();
        rebuildTable();
      });

      diaSelect.addEventListener("change", function () {
        clearSelection();
        rebuildTable();
      });

      clearSelectionBtn.addEventListener("click", function () {
        clearSelection();
      });
    })();
  </script>
</body>
</html>
